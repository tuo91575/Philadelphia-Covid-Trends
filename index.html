<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
	<style> .btn{border:1px solid black; padding:5px;display:inline-block} </style>
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="col-md-2">
			</div>
			<div id="div-list" class="col-md-8">
				<h1>Covid Deaths Over Time</h1>
                <br>
                <p>Here we are able to see a change in the spread of covid over a period of time over the Philidelphia area. Your able to see if there are spikes in covid and what meassures are best to prevent risk of catching covid. If covid is very common in the area your better off wearing a mask while if its uncommon you might prefer better comfort.</p>
                <br>
                <p>*Note data begins March 30th 2020</p>
				<input type="button" id="btn_load_data" value="Load Data" class="btn btn-primary">
				<br><br>
                <input type="button" id="btn_load_chart" value="Load Daily Chart" class="btn btn-primary">
				<br><br>
                <input type="button" id="btn_load_Monthly_chart" value="Load Monthly Chart" class="btn btn-primary">
				<br><br>
				<div id="datainsert"></div>
				<br><br>			
                <div id="secretcheck"></div>	
			</div>
			<div class="col-md-2">
			</div>
		</div>
	</div>
</body>
<script>
"use strict";
$("#secretcheck").hide();
// Defining Variables
let datadate = "";
let datax = "";
let datay = "";
let datacharty = "";
let secretcheck = "";
let dataz = "";
let datacases = "";
let confirmation = "";
let chartapicall = "";
let hospitalizations = ""
let currentmonthcheck = ""
let currentyearcheck = ""
let currentmonthcasecount = 0
let defusedcount = ""
let defusing = ""

function variablesanatize(){
    //Clearing all variables to ensure they are clean and don't leak data from previous checks
    datadate = "";
    datax = "";
    datay = "";
    datacharty = "";
    secretcheck = "";
    dataz = "";
    datacases = "";
    confirmation = "";
    chartapicall = "";
    hospitalizations = "";
    currentmonthcheck = ""
    currentyearcheck = ""
    currentmonthcasecount = 0
    defusedcount = ""
    defusing = ""
}

function CSVDataLoader(){
// Load Covid Deaths
$.get("https://phl.carto.com/api/v2/sql?filename=covid_deaths_by_date&format=csv&skipfields=cartodb_id,the_geom,the_geom_webmercator&q=SELECT%20*%20FROM%20covid_deaths_by_date",function(result){

    result = result.split("\r\n");
    dataz = result.sort()
});
$.get("https://phl.carto.com/api/v2/sql?filename=covid_deaths_by_date&format=csv&skipfields=cartodb_id,the_geom,the_geom_webmercator&q=SELECT%20*%20FROM%20covid_deaths_by_date",function(result){

    result = result.split("\r\n");
    hospitalizations = result.sort()
});
}

function LoadLeData(){
if (dataz != ""){
    secretcheck = "Confirmed" 
}

if (secretcheck != "Confirmed"){
        setTimeout(function(){
            LoadLeData()
}, 2000);
    } else

    for(let i=2; i < dataz.length - 1; i++){
datadate = dataz[i][0] + dataz[i][1] + dataz[i][2] + dataz[i][3] + dataz[i][4] + dataz[i][5] + dataz[i][6] + dataz[i][7] + dataz[i][8] + dataz[i][9]
       datax = dataz[i][16]
       if (dataz[i][17] != ","){
        datax = datax + dataz[i][17]
       }
datay = datay + ("Date : " + datadate + " Number of deaths: " + datax + "<br>")
    }

    $("#datainsert").html(datay)

}

function ChartingTheData(){
    if (confirmation == ""){
        confirmation = window.confirm("Warning this option charts every single day and may be slow to load and hard to read, It's recommended you select a different option(Such as weekly or monthly). Press Ok to continue.")
    } 

    if (confirmation == false){
return
}
    if (dataz != ""){
    secretcheck = "Confirmed" 
}


if (secretcheck != "Confirmed"){
        setTimeout(function(){
            ChartingTheData()
}, 2000);
return
    }

for(let i=2; i < dataz.length - 1; i++){
    if (datadate == ""){
        datadate = dataz[i][0] + dataz[i][1] + dataz[i][2] + dataz[i][3] + dataz[i][4] + dataz[i][5] + dataz[i][6] + dataz[i][7] + dataz[i][8] + dataz[i][9]
    } else {
        datadate = datadate + "%22%2C%22" + dataz[i][0] + dataz[i][1] + dataz[i][2] + dataz[i][3] + dataz[i][4] + dataz[i][5] + dataz[i][6] + dataz[i][7] + dataz[i][8] + dataz[i][9]

    }
datax = dataz[i][16]
if (dataz[i][17] != ","){
        datax = datax + dataz[i][17]
       }
       if(datacases == ""){
        datacases = datax
       }else{datacases = datacases + "%2C" + datax}

}
chartapicall = "https://image-charts.com/chart.js/2.8.0?bkg=white&c=%7B%0A%20%20type%3A%20%27line%27%2C%0A%20%20data%3A%20%7B%0A%20%20%20%20labels%3A%20%5B%22" + datadate  + "%22%5D%2C%0A%20%20%20%20datasets%3A%20%5B%0A%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20label%3A%20%27Covid%20Cases%27%2C%0A%20%20%20%20%20%20%20%20backgroundColor%3A%20%27rgb%28255%2C%2099%2C%20132%29%27%2C%0A%20%20%20%20%20%20%20%20borderColor%3A%20%27rgb%28255%2C%2099%2C%20132%29%27%2C%0A%20%20%20%20%20%20%20%20data%3A%20%5B"+ datacases + "%5D%2C%0A%20%20%20%20%20%20%20%20fill%3A%20false%2C%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%5D%2C%0A%20%20%7D%2C%0A%20%20options%3A%20%7B%0A%20%20%20%20title%3A%20%7B%0A%20%20%20%20%20%20display%3A%20true%2C%0A%20%20%20%20%20%20text%3A%20%27Covid%20Cases%20in%20Philadelphia%27%2C%0A%20%20%20%20%7D%2C%0A%20%20%7D%2C%0A%7D%0A"
$("#datainsert").html("<img src='" + chartapicall + "'>"); 
}

function ChartingTheMonthlyData(){
    if (dataz != ""){
    secretcheck = "Confirmed" 
}

if (secretcheck != "Confirmed"){
        setTimeout(function(){
            ChartingTheMonthlyData()
}, 2000);
    } else

for(let i=2; i < dataz.length - 1; i++){
    
//datadate = dataz[i][0] + dataz[i][1] + dataz[i][2] + dataz[i][3] + dataz[i][4] + dataz[i][5] + dataz[i][6] + dataz[i][7] + dataz[i][8] + dataz[i][9]
if ((dataz[i][5] + dataz[i][6]) == currentmonthcheck){
        datax = dataz[i][16]
if (dataz[i][17] != ","){
        datax = datax + dataz[i][17]
       }
       datay = parseFloat(datax)
       currentmonthcasecount = currentmonthcasecount + datay
} else if(currentmonthcheck == 0){
    currentmonthcheck = dataz[i][5] + dataz[i][6]
    
}else {
    if (currentyearcheck == 0){
        currentyearcheck = dataz[i][2] + dataz[i][3]
    }
    if (defusing == ""){
        defusing = currentmonthcheck + "-20" + currentyearcheck
    } else {
        defusing = defusing + "%22%2C%22" + currentmonthcheck + "-20" + currentyearcheck
    }
 if (defusedcount == ""){
    defusedcount = currentmonthcasecount
 }else{defusedcount = defusedcount + "%2C" + currentmonthcasecount }
    currentmonthcheck = dataz[i][5] + dataz[i][6]
    currentmonthcasecount = 0

}

if ((dataz[i][2] + dataz[i][3]) == currentyearcheck){
} else {
    if (currentyearcheck == 0){
        currentyearcheck = dataz[i][2] + dataz[i][3]
    }
    currentyearcheck = dataz[i][2] + dataz[i][3]
}


datacases = datacases + datax + "|"


if (i == dataz.length - 2){
    defusing = defusing + "%22%2C%22" + currentmonthcheck + "-20" + currentyearcheck
    defusedcount = defusedcount + "%2C" + currentmonthcasecount
}
}

chartapicall = "https://image-charts.com/chart.js/2.8.0?bkg=white&c=%7B%0A%20%20type%3A%20%27line%27%2C%0A%20%20data%3A%20%7B%0A%20%20%20%20labels%3A%20%5B%22" + defusing  + "%22%5D%2C%0A%20%20%20%20datasets%3A%20%5B%0A%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20label%3A%20%27Covid%20Cases%27%2C%0A%20%20%20%20%20%20%20%20backgroundColor%3A%20%27rgb%28255%2C%2099%2C%20132%29%27%2C%0A%20%20%20%20%20%20%20%20borderColor%3A%20%27rgb%28255%2C%2099%2C%20132%29%27%2C%0A%20%20%20%20%20%20%20%20data%3A%20%5B"+ defusedcount + "%5D%2C%0A%20%20%20%20%20%20%20%20fill%3A%20false%2C%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%5D%2C%0A%20%20%7D%2C%0A%20%20options%3A%20%7B%0A%20%20%20%20title%3A%20%7B%0A%20%20%20%20%20%20display%3A%20true%2C%0A%20%20%20%20%20%20text%3A%20%27Covid%20Cases%20in%20Philadelphia%27%2C%0A%20%20%20%20%7D%2C%0A%20%20%7D%2C%0A%7D%0A"
$("#datainsert").html("<img src='" + chartapicall + "'>"); 

}


$('#btn_load_data').click(function(){
    variablesanatize()
    $("#datainsert").html("")
    CSVDataLoader()
    LoadLeData()

})

$('#btn_load_chart').click(function(){
    variablesanatize()
    $("#datainsert").html("")
    CSVDataLoader()
    ChartingTheData()
})

$('#btn_load_Monthly_chart').click(function(){
    variablesanatize()
    $("#datainsert").html("")
    CSVDataLoader()
    ChartingTheMonthlyData()
})

</script>
</html>
